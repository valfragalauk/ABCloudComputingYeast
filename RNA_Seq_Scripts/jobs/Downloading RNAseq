

# exported downloaded SRR_Acc_List.txt from local to HPC directory ~/ RNAseq

# converting the accession numbers to sra formatted files using SRA toolkit 

	module avail sra-tools/3.0.3-gcc-13.2.0
	module load sra-tools/3.0.3-gcc-13.2.0
		
		# this loads the sra toolkit which includes prefetch and fasterq dump

# downloading the sra files using prefetch

	prefetch --option-file SRR_Acc_list.txt --output-directory sra/    

	# --option-file specifies the input list
	# this will download each SRR accession number from the list  into sra directory 

#  converting sra formatted files to FASTQ

	cat SRR_Acc_List.txt | xargs -I {} sh -c 'fasterq-dump sra/{}/{}.sra --split-files --threads 8 -O fastq_final/'


# fasterq-dump converts SRA to FASTQ
# --split-files generates paired end reads (*_1.fastq and *_2.fastq)
# --threads 8 the cpus?
#  output (fastq files) will be saved in fastq_final directory (creates new directory/folder)


# QC FASTQ files

	module load fastqc

	fastqc *.fastq -o add/path/where/you/want/to save/ the /QC/

		# A zip and a HTML file will be produced for each paired sequence so total of 4 QC files



# I used the below code but didn’t work try if you want or use the other file still trying to figure out how to do quantification + alignment 


# aligning with bowtie2

# Open slurm job

		nano bowtie2_R64 # for single sample

		#!/bin/bash
		#SBATCH --job-name=bowtie2_R64
		#SBATCH --partition=msc_appbio
		#SBATCH --nodes=1
		#SBATCH --ntasks=4
		#SBATCH --time=02:00:00
		#SBATCH --output=bowtie2_R64_%j.out

		module load bowtie2

  # R_1

	bowtie2 -p 4 \			# -p 4: use 4 threads 
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \       # path to the reference genome built in previous step
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/SY14/SRR7059704_1.fastq \ # -1 first fastq file 
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/SY14/SRR7059704_2.fastq \  # -2 second fastq file
  		-S SRR7059704_R64.sam                                                        # -S output sam file. The  will be outputted as SRR7059704_R64

	bowtie2 -p 4 \
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/BY4272/SRR7059709_1.fastq \
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/BY4272/SRR7059709_2.fastq \
  		-S SRR7059709_R64.sam


# R_2

	bowtie2 -p 4 \
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_2/SY14/SRR7059705_1.fastq \
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_2/SY14/SRR7059705_2.fastq \
  		-S SRR7059705_R64.sam

	bowtie2 -p 4 \
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_2/BY4272/SRR7059706_1.fastq \ 
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_2/BY4272/SRR7059706_2.fastq \
  		-S SRR7059706_R64.sam

# R_3

	bowtie2 -p 4 \
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_3/SY14/SRR7059708_1.fastq \
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_3/SY14/SRR7059708_2.fastq \
  		-S SRR7059708_R64.sam

	bowtie2 -p 4 \
 		 -x /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \
 		 -1 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/BY4272/SRR7059707_1.fastq \
  		-2 /scratch/grp/msc_appbio/Group2_ABCC/RNAseq/R_1/BY4272/SRR7059707_2.fastq \
  		-S SRR7059707_R64.sam



		sbatch bowtie2_R64.slurm        # to execute the slurm comand with nano file name


# convert SAM files to BAM (compressed version) for more efficient processing I was able to convert SAM to BAM but the converted files weren’t compatible with RSEM (they need RSEM SPECIFIC BAM files?)

		
		module avail samtools
		module load samtools
	
	
nano (name:samtools_convert).slurm (#ran the conversion through SLURM)

#!/bin/bash
#SBATCH --job-name=samtools_convert_sort
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=16G
#SBATCH --time=03:00:00
#SBATCH --output=samtools-%j.out

		samtools view -b (input your file name).sam > (add your file name for output).bam

		samtools sort (output file name).bam -o (output file name).sorted.bam

		samtools index filename.sorted.bam		# this creates an index file


# save and exit


sbatch (name).slurm 			#runs the job and produces bam files


# RNA quantification with RSEM keeps getting errors


     	rsem-calculate-expression \
  --allignment
  --paired-end \						# data are paired reads
  --estimate-rspd \
  -p 4 \
  sorted_output.bam \
/scratch/grp/msc_appbio/Group2_ABCC/RNAseq/ref_genome/yeast_rsem \ # the reference prepared earlier
  BY4272_R1
 


# differentially expressed gene analysis in R
